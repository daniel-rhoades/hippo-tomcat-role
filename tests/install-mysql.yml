#- name: Setup MySQL server as a Docker container from the official image
#  docker:
#    state: reloaded
#    image: mysql:latest
#    ports:
#      - 3306:3306
#    name: "gogreen-mysql"
#    env:
#      MYSQL_ROOT_PASSWORD: password

- name: Install a Telnet client to check the database state
  apt: name=telnet

- name: Wait for the MySQL server to be available
  shell: telnet localhost 3306 || true
  register: result
  until: result.stdout.find("mysql_native_password") != -1
  retries: 5
  delay: 5

- name: Install a MySQL client to initialise the database state
  apt: name=mysql-client-5.5

- name: Create an empty GoGreen database instance with a username and password
  command: "/vagrant/tests/create-gogreen-db.sh"